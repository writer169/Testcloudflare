<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - D1 Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module">
      
import React, { useState, useEffect } from 'react'; [span_0](start_span)//[span_0](end_span) Объединенный и исправленный импорт
import ReactDOM from 'react-dom/client'; [span_1](start_span)//[span_1](end_span) Исправленный импорт
[span_2](start_span)import { Plus, Key, Trash2, RefreshCw, Eye, EyeOff, Users, Package, Shield, CheckCircle, XCircle, Copy, Check, Award } from 'lucide-react';[span_2](end_span)

[span_3](start_span)const AdminPanel = () => {[span_3](end_span)
  [span_4](start_span)const [isAuthenticated, setIsAuthenticated] = useState(false);[span_4](end_span)
  [span_5](start_span)const [masterKey, setMasterKey] = useState('');[span_5](end_span)
  [span_6](start_span)const [baseUrl, setBaseUrl] = useState('https://testcloudflare-t45.pages.dev');[span_6](end_span)
  
  [span_7](start_span)const [apps, setApps] = useState([]);[span_7](end_span)
  [span_8](start_span)const [users, setUsers] = useState([]);[span_8](end_span)
  [span_9](start_span)const [userApps, setUserApps] = useState([]);[span_9](end_span)
  [span_10](start_span)const [activeTab, setActiveTab] = useState('apps');[span_10](end_span)
  [span_11](start_span)const [showKeys, setShowKeys] = useState({});[span_11](end_span)
  [span_12](start_span)const [copiedKey, setCopiedKey] = useState('');[span_12](end_span)
  [span_13](start_span)const [newApp, setNewApp] = useState({ app_id: '', app_name: '' });[span_13](end_span)
  [span_14](start_span)const [newUser, setNewUser] = useState({ username: '', user_id: '', role: 'user' });[span_14](end_span)
  
  [span_15](start_span)const authenticate = async () => {[span_15](end_span)
    [span_16](start_span)if (!masterKey) {[span_16](end_span)
      [span_17](start_span)alert('Введите мастер-ключ');[span_17](end_span)
      [span_18](start_span)return;[span_18](end_span)
    }
    
    [span_19](start_span)try {[span_19](end_span)
      [span_20](start_span)const response = await fetch(`${baseUrl}/api/admin`, {[span_20](end_span)
        [span_21](start_span)method: 'POST',[span_21](end_span)
        [span_22](start_span)headers: {[span_22](end_span)
          [span_23](start_span)'Authorization': `Bearer ${masterKey}`,[span_23](end_span)
          [span_24](start_span)'Content-Type': 'application/json'[span_24](end_span)
        },
        [span_25](start_span)body: JSON.stringify({ action: 'verify' })[span_25](end_span)
      });
      [span_26](start_span)if (response.ok) {[span_26](end_span)
        [span_27](start_span)setIsAuthenticated(true);[span_27](end_span)
        [span_28](start_span)loadData();[span_28](end_span)
      [span_29](start_span)} else {[span_29](end_span)
        [span_30](start_span)alert('Неверный мастер-ключ');[span_30](end_span)
      }
    [span_31](start_span)} catch (err) {[span_31](end_span)
      [span_32](start_span)alert('Ошибка подключения');[span_32](end_span)
    }
  };

  [span_33](start_span)const loadData = async () => {[span_33](end_span)
    [span_34](start_span)try {[span_34](end_span)
      [span_35](start_span)const [appsRes, usersRes, userAppsRes] = await Promise.all([[span_35](end_span)
        [span_36](start_span)apiCall('list_apps'),[span_36](end_span)
        [span_37](start_span)apiCall('list_users'),[span_37](end_span)
        [span_38](start_span)apiCall('list_user_apps')[span_38](end_span)
      ]);
      [span_39](start_span)if (appsRes?.data) setApps(appsRes.data);[span_39](end_span)
      [span_40](start_span)if (usersRes?.data) setUsers(usersRes.data);[span_40](end_span)
      [span_41](start_span)if (userAppsRes?.data) setUserApps(userAppsRes.data);[span_41](end_span)
    [span_42](start_span)} catch (err) {[span_42](end_span)
      [span_43](start_span)console.error('Load error:', err);[span_43](end_span)
    }
  [span_44](start_span)};[span_44](end_span)

  const apiCall = async (action, data = {}) => {
    [span_45](start_span)const response = await fetch(`${baseUrl}/api/admin`, {[span_45](end_span)
      [span_46](start_span)method: 'POST',[span_46](end_span)
      [span_47](start_span)headers: {[span_47](end_span)
        [span_48](start_span)'Authorization': `Bearer ${masterKey}`,[span_48](end_span)
        [span_49](start_span)'Content-Type': 'application/json'[span_49](end_span)
      },
      [span_50](start_span)body: JSON.stringify({ action, ...data })[span_50](end_span)
    });
    [span_51](start_span)return response.json();[span_51](end_span)
  };

  const registerApp = async () => {
    [span_52](start_span)if (!newApp.app_id || !newApp.app_name) {[span_52](end_span)
      [span_53](start_span)alert('Заполните все поля');[span_53](end_span)
      [span_54](start_span)return;[span_54](end_span)
    }
    
    [span_55](start_span)const result = await apiCall('register_app', newApp);[span_55](end_span)
    [span_56](start_span)if (result.status === 'ok') {[span_56](end_span)
      [span_57](start_span)setNewApp({ app_id: '', app_name: '' });[span_57](end_span)
      [span_58](start_span)loadData();[span_58](end_span)
      [span_59](start_span)alert(`Приложение создано!\n\nКлюч:\n${result.app_key}\n\nСохраните его!`);[span_59](end_span)
    [span_60](start_span)} else {[span_60](end_span)
      [span_61](start_span)alert('Ошибка: ' + result.message);[span_61](end_span)
    }
  };
  
  [span_62](start_span)const registerUser = async () => {[span_62](end_span)
    [span_63](start_span)if (!newUser.username) {[span_63](end_span)
      [span_64](start_span)alert('Введите имя пользователя');[span_64](end_span)
      [span_65](start_span)return;[span_65](end_span)
    }
    
    [span_66](start_span)const result = await apiCall('register_user', newUser);[span_66](end_span)
    [span_67](start_span)if (result.status === 'ok') {[span_67](end_span)
      [span_68](start_span)setNewUser({ username: '', user_id: '', role: 'user' });[span_68](end_span)
      [span_69](start_span)loadData();[span_69](end_span)
      [span_70](start_span)alert(`Пользователь создан!\n\nID: ${result.user_id}\nКлюч: ${result.user_key}\nРоль: ${result.role}\n\nСохраните ключ!`);[span_70](end_span)
    } else {
      [span_71](start_span)alert('Ошибка: ' + result.message);[span_71](end_span)
    [span_72](start_span)}
  };

  const updateRole = async (userId, newRole) => {[span_72](end_span)
    [span_73](start_span)const result = await apiCall('update_role', { user_id: userId, role: newRole });[span_73](end_span)
    [span_74](start_span)if (result.status === 'ok') {[span_74](end_span)
      [span_75](start_span)loadData();[span_75](end_span)
      [span_76](start_span)alert(`Роль обновлена на: ${newRole}`);[span_76](end_span)
    }
  [span_77](start_span)};[span_77](end_span)

  [span_78](start_span)const regenerateKey = async (type, id) => {[span_78](end_span)
    [span_79](start_span)if (!confirm('Старый ключ перестанет работать. Продолжить?')) return;[span_79](end_span)
    const action = type === 'app' ? [span_80](start_span)'regenerate_app_key' : 'regenerate_user_key';[span_80](end_span)
    const field = type === 'app' ? [span_81](start_span)'app_id' : 'user_id';[span_81](end_span)
    [span_82](start_span)const result = await apiCall(action, { [field]: id });[span_82](end_span)
    [span_83](start_span)if (result.status === 'ok') {[span_83](end_span)
      [span_84](start_span)loadData();[span_84](end_span)
      [span_85](start_span)alert(`Новый ключ:\n${result.new_key}\n\nСохраните его!`);[span_85](end_span)
    }
  };

  [span_86](start_span)const deleteItem = async (type, id) => {[span_86](end_span)
    [span_87](start_span)if (!confirm('Удалить безвозвратно?')) return;[span_87](end_span)
    const action = type === 'app' ? [span_88](start_span)'delete_app' : 'delete_user';[span_88](end_span)
    const field = type === 'app' ? [span_89](start_span)'app_id' : 'user_id';[span_89](end_span)
    [span_90](start_span)const result = await apiCall(action, { [field]: id });[span_90](end_span)
    [span_91](start_span)if (result.status === 'ok') {[span_91](end_span)
      [span_92](start_span)loadData();[span_92](end_span)
    [span_93](start_span)}
  };

  const toggleAccess = async (userId, appId, hasAccess) => {[span_93](end_span)
    [span_94](start_span)const action = hasAccess ?[span_94](end_span)
      [span_95](start_span)'revoke_access' : 'grant_access';[span_95](end_span)
    [span_96](start_span)const result = await apiCall(action, { user_id: userId, app_id: appId });[span_96](end_span)
    [span_97](start_span)if (result.status === 'ok') {[span_97](end_span)
      [span_98](start_span)loadData();[span_98](end_span)
    [span_99](start_span)}
  };

  const copyKey = (key) => {[span_99](end_span)
    [span_100](start_span)navigator.clipboard.writeText(key);[span_100](end_span)
    [span_101](start_span)setCopiedKey(key);[span_101](end_span)
    [span_102](start_span)setTimeout(() => setCopiedKey(''), 2000);[span_102](end_span)
  };

  [span_103](start_span)const hasAccess = (userId, appId) => {[span_103](end_span)
    [span_104](start_span)return userApps.some(ua => ua.user_id === userId && ua.app_id === appId);[span_104](end_span)
  [span_105](start_span)};[span_105](end_span)

  const getRoleBadge = (role) => {
    [span_106](start_span)const colors = {[span_106](end_span)
      [span_107](start_span)admin: 'bg-red-500/20 text-red-400 border-red-500/30',[span_107](end_span)
      [span_108](start_span)user: 'bg-blue-500/20 text-blue-400 border-blue-500/30',[span_108](end_span)
      [span_109](start_span)readonly: 'bg-gray-500/20 text-gray-400 border-gray-500/30'[span_109](end_span)
    };
    [span_110](start_span)return colors[role] || colors.user;[span_110](end_span)
  };

  [span_111](start_span)if (!isAuthenticated) {[span_111](end_span)
    return (
      [span_112](start_span)<div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4">[span_112](end_span)
        [span_113](start_span)<div className="bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-8 w-full max-w-md">[span_113](end_span)
          [span_114](start_span)<div className="flex items-center gap-3 mb-6">[span_114](end_span)
            [span_115](start_span)<Shield className="text-purple-400" size={32} />[span_115](end_span)
            [span_116](start_span)<h1 className="text-2xl font-bold text-white">Admin Panel</h1>[span_116](end_span)
          </div>
  
          [span_117](start_span)<div className="space-y-4">[span_117](end_span)
            <div>
              [span_118](start_span)<label className="block text-sm text-slate-400 mb-2">Base URL</label>[span_118](end_span)
              <input
                type="text"
                value={baseUrl}
                [span_119](start_span)onChange={(e) => setBaseUrl(e.target.value)}[span_119](end_span)
                className="w-full bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"
                [span_120](start_span)placeholder="https://your-app.pages.dev"[span_120](end_span)
              />
            </div>
            
            [span_121](start_span)<div>[span_121](end_span)
              [span_122](start_span)<label className="block text-sm text-slate-400 mb-2">Master Key</label>[span_122](end_span)
              <input
                type="password"
                value={masterKey}
                [span_123](start_span)onChange={(e) => setMasterKey(e.target.value)}[span_123](end_span)
                [span_124](start_span)onKeyPress={(e) => e.key === 'Enter' && authenticate()}[span_124](end_span)
                className="w-full bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"
                placeholder="Введите мастер-ключ"
              />
            </div>
            
            <button
              [span_125](start_span)onClick={authenticate}[span_125](end_span)
              className="w-full bg-purple-600 hover:bg-purple-700 text-white rounded-lg px-4 py-3 font-semibold transition"
            >
              Войти
            </button>
          </div>
        </div>
      </div>
    [span_126](start_span));[span_126](end_span)
  }

  return (
    [span_127](start_span)<div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-8">[span_127](end_span)
      [span_128](start_span)<div className="max-w-6xl mx-auto">[span_128](end_span)
        [span_129](start_span)<header className="mb-8">[span_129](end_span)
          [span_130](start_span)<div className="flex items-center justify-between mb-4">[span_130](end_span)
            [span_131](start_span)<div className="flex items-center gap-3">[span_131](end_span)
              [span_132](start_span)<Shield className="text-purple-400" size={32} />[span_132](end_span)
              [span_133](start_span)<h1 className="text-3xl font-bold text-white">Admin Panel</h1>[span_133](end_span)
            </div>
            <button
              [span_134](start_span)onClick={() => setIsAuthenticated(false)}[span_134](end_span)
              className="text-slate-400 hover:text-white transition text-sm"
            >
              Выйти
            </button>
          [span_135](start_span)</div>[span_135](end_span)
          
          <div className="flex gap-2">
            <button
              [span_136](start_span)onClick={() => setActiveTab('apps')}[span_136](end_span)
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
                [span_137](start_span)activeTab === 'apps'[span_137](end_span)
                ? [span_138](start_span)'bg-purple-600 text-white'[span_138](end_span)
                  : 'bg-slate-800/50 text-slate-400 hover:text-white'
              }`}
            >
              [span_139](start_span)<Package size={18} />[span_139](end_span)
              Приложения
            </button>
 
            [span_140](start_span)<button[span_140](end_span)
              [span_141](start_span)onClick={() => setActiveTab('users')}[span_141](end_span)
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
                [span_142](start_span)activeTab === 'users'[span_142](end_span)
                  ? [span_143](start_span)'bg-purple-600 text-white'[span_143](end_span)
                  : 'bg-slate-800/50 text-slate-400 hover:text-white'
              }`}
            >
              [span_144](start_span)<Users size={18} />[span_144](end_span)
              Пользователи
            </button>
          
            [span_145](start_span)<button[span_145](end_span)
              [span_146](start_span)onClick={() => setActiveTab('access')}[span_146](end_span)
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
                [span_147](start_span)activeTab === 'access'[span_147](end_span)
                  ? [span_148](start_span)'bg-purple-600 text-white'[span_148](end_span)
                  : 'bg-slate-800/50 text-slate-400 hover:text-white'
              }`}
            >
              [span_149](start_span)<Key size={18} />[span_149](end_span)
              Доступы
            </button>
          [span_150](start_span)</div>[span_150](end_span)
        </header>

        [span_151](start_span){activeTab === 'apps' && ([span_151](end_span)
          [span_152](start_span)<div className="space-y-6">[span_152](end_span)
            [span_153](start_span)<div className="bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6">[span_153](end_span)
              [span_154](start_span)<h2 className="text-xl font-bold text-white mb-4">Добавить приложение</h2>[span_154](end_span)
              [span_155](start_span)<div className="grid grid-cols-1 md:grid-cols-2 gap-4">[span_155](end_span)
                [span_156](start_span)<input[span_156](end_span)
                  type="text"
                  placeholder="App ID (например: tasker)"
                  value={newApp.app_id}
                  [span_157](start_span)onChange={(e) => setNewApp({ ...newApp, app_id: e.target.value })}[span_157](end_span)
                  [span_158](start_span)className="bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"[span_158](end_span)
                />
                <input
                  type="text"
                  [span_159](start_span)placeholder="Название (например: Tasker)"[span_159](end_span)
                  value={newApp.app_name}
                  [span_160](start_span)onChange={(e) => setNewApp({ ...newApp, app_name: e.target.value })}[span_160](end_span)
                  className="bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"
                />
              </div>
              <button
                [span_161](start_span)onClick={registerApp}[span_161](end_span)
                className="mt-4 bg-green-600 hover:bg-green-700 text-white rounded-lg px-6 py-2 flex items-center gap-2 transition"
              >
                [span_162](start_span)<Plus size={18} />[span_162](end_span)
                Создать приложение
              </button>
            [span_163](start_span)</div>[span_163](end_span)

            [span_164](start_span)<div className="grid gap-4">[span_164](end_span)
              {apps.map((app) => (
                [span_165](start_span)<div key={app.app_id} className="bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6">[span_165](end_span)
                  [span_166](start_span)<div className="flex items-start justify-between mb-4">[span_166](end_span)
                    <div>
                      [span_167](start_span)<h3 className="text-xl font-bold text-white">{app.app_name}</h3>[span_167](end_span)
                      [span_168](start_span)<p className="text-sm text-slate-400">ID: {app.app_id}</p>[span_168](end_span)
                    </div>
                    [span_169](start_span)<div className="flex gap-2">[span_169](end_span)
                      [span_170](start_span)<button[span_170](end_span)
                        onClick={() => regenerateKey('app', app.app_id)}
                        className="p-2 bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400 rounded-lg transition"
                        title="Перегенерировать ключ"
                      > [span_171](start_span)
                        <RefreshCw size={18} />
                      </button>
                      <button
                        onClick={() => deleteItem('app', app.app_id)}[span_171](end_span)
                        className="p-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg transition"
                        title="Удалить"
                      >
                        [span_172](start_span)<Trash2 size={18} />[span_172](end_span)
                      </button>
                    </div>
                  </div>
                  
                  [span_173](start_span)<div className="bg-slate-900/50 rounded-lg p-3">[span_173](end_span)
                    [span_174](start_span)<div className="flex items-center justify-between gap-2">[span_174](end_span)
                      <code className="text-xs text-green-400 font-mono break-all">
                        [span_175](start_span){showKeys[app.app_id] ?[span_175](end_span)
                          [span_176](start_span)app.app_key : '••••••••••••••••••••••••••••••••'}[span_176](end_span)
                      </code>
                      [span_177](start_span)<div className="flex gap-2 shrink-0">[span_177](end_span)
                        <button
                          [span_178](start_span)onClick={() => setShowKeys({ ...showKeys, [app.app_id]: !showKeys[app.app_id] })}[span_178](end_span)
                          className="p-1 hover:bg-slate-800 rounded transition"
                        >
                          [span_179](start_span){showKeys[app.app_id] ?[span_179](end_span)
                            [span_180](start_span)<EyeOff size={16} className="text-slate-400" /> : <Eye size={16} className="text-slate-400" />}[span_180](end_span)
                        </button>
                        <button
                          [span_181](start_span)onClick={() => copyKey(app.app_key)}[span_181](end_span)
                          className="p-1 hover:bg-slate-800 rounded transition"
                        >
                          [span_182](start_span){copiedKey === app.app_key ?[span_182](end_span)
                            [span_183](start_span)<Check size={16} className="text-green-400" /> : <Copy size={16} className="text-slate-400" />}[span_183](end_span)
                        </button>
                      </div>
                    </div>
                  </div>
        
                  [span_184](start_span)<p className="text-xs text-slate-500 mt-2">[span_184](end_span)
                    [span_185](start_span)Создано: {new Date(app.created_at).toLocaleString('ru-RU')}[span_185](end_span)
                  </p>
                </div>
              [span_186](start_span)))}[span_186](end_span)
            </div>
          </div>
        )}

        [span_187](start_span){activeTab === 'users' && ([span_187](end_span)
          [span_188](start_span)<div className="space-y-6">[span_188](end_span)
            [span_189](start_span)<div className="bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6">[span_189](end_span)
              [span_190](start_span)<h2 className="text-xl font-bold text-white mb-4">Добавить пользователя</h2>[span_190](end_span)
              [span_191](start_span)<div className="grid grid-cols-1 md:grid-cols-3 gap-4">[span_191](end_span)
                <input
                  type="text"
                  [span_192](start_span)placeholder="Username (john)"[span_192](end_span)
                  value={newUser.username}
                  [span_193](start_span)onChange={(e) => setNewUser({ ...newUser, username: e.target.value })}[span_193](end_span)
                  className="bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"
                />
                <input
                  type="text"
                  [span_194](start_span)placeholder="User ID (опционально)"[span_194](end_span)
                  [span_195](start_span)value={newUser.user_id}[span_195](end_span)
                  onChange={(e) => setNewUser({ ...newUser, user_id: e.target.value })}
                  className="bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"
                />
                [span_196](start_span)<select[span_196](end_span)
                  value={newUser.role}
                  onChange={(e) => setNewUser({ ...newUser, role: e.target.value })}
                  className="bg-slate-900/50 border border-slate-700 rounded-lg px-4 py-2 text-white"
                >
                  [span_197](start_span)<option value="user">User</option>[span_197](end_span)
                  [span_198](start_span)<option value="admin">Admin</option>[span_198](end_span)
                  [span_199](start_span)<option value="readonly">Readonly</option>[span_199](end_span)
                </select>
              </div>
              <button
                [span_200](start_span)onClick={registerUser}[span_200](end_span)
                className="mt-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-6 py-2 flex items-center gap-2 transition"
              >
                [span_201](start_span)<Plus size={18} />[span_201](end_span)
                Создать пользователя
              </button>
            </div>

            [span_202](start_span)<div className="grid gap-4">[span_202](end_span)
              {users.map((user) => (
                [span_203](start_span)<div key={user.user_id} className="bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6">[span_203](end_span)
                  [span_204](start_span)<div className="flex items-start justify-between mb-4">[span_204](end_span)
                    [span_205](start_span)<div className="flex-1">[span_205](end_span)
                      [span_206](start_span)<div className="flex items-center gap-2 mb-1">[span_206](end_span)
                        <h3 className="text-xl font-bold text-white">{user.username}</h3>
                        [span_207](start_span)<span className={`px-2 py-1 rounded text-xs border ${getRoleBadge(user.role)}`}>[span_207](end_span)
                          [span_208](start_span){user.role}[span_208](end_span)
                        </span>
                      </div>
                      [span_209](start_span)<p className="text-sm text-slate-400">ID: {user.user_id}</p>[span_209](end_span)
                      [span_210](start_span)<select[span_210](end_span)
                        value={user.role}
                        onChange={(e) => updateRole(user.user_id, e.target.value)}
                        className="mt-2 bg-slate-900/50 border border-slate-700 rounded px-3 py-1 text-sm text-white"
                      >
                        [span_211](start_span)<option value="user">User</option>[span_211](end_span)
                        <option value="admin">Admin</option>
                        [span_212](start_span)<option value="readonly">Readonly</option>[span_212](end_span)
                      [span_213](start_span)</select>[span_213](end_span)
                    </div>
                    [span_214](start_span)<div className="flex gap-2">[span_214](end_span)
                      <button
                        [span_215](start_span)onClick={() => regenerateKey('user', user.user_id)}[span_215](end_span)
                        className="p-2 bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400 rounded-lg transition"
                        title="Перегенерировать ключ"
                      >
                        [span_216](start_span)<RefreshCw size={18} />[span_216](end_span)
                      </button>
                      <button
                        [span_217](start_span)onClick={() => deleteItem('user', user.user_id)}[span_217](end_span)
                        className="p-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg transition"
                        [span_218](start_span)title="Удалить"[span_218](end_span)
                      >
                        [span_219](start_span)<Trash2 size={18} />[span_219](end_span)
                      </button>
                    [span_220](start_span)</div>[span_220](end_span)
                  </div>
                  
                  [span_221](start_span)<div className="bg-slate-900/50 rounded-lg p-3">[span_221](end_span)
                    [span_222](start_span)<div className="flex items-center justify-between gap-2">[span_222](end_span)
                      [span_223](start_span)<code className="text-xs text-blue-400 font-mono break-all">[span_223](end_span)
                        [span_224](start_span){showKeys[user.user_id] ?[span_224](end_span)
                          [span_225](start_span)user.user_key : '••••••••••••••••••••••••••••••••'}[span_225](end_span)
                      </code>
                      [span_226](start_span)<div className="flex gap-2 shrink-0">[span_226](end_span)
                        <button
                          [span_227](start_span)onClick={() => setShowKeys({ ...showKeys, [user.user_id]: !showKeys[user.user_id] })}[span_227](end_span)
                          className="p-1 hover:bg-slate-800 rounded transition"
                        >
                          [span_228](start_span){showKeys[user.user_id] ?[span_228](end_span)
                            [span_229](start_span)<EyeOff size={16} className="text-slate-400" /> : <Eye size={16} className="text-slate-400" />}[span_229](end_span)
                        </button>
                        <button
                          [span_230](start_span)onClick={() => copyKey(user.user_key)}[span_230](end_span)
                          className="p-1 hover:bg-slate-800 rounded transition"
                        >
                          [span_231](start_span){copiedKey === user.user_key ?[span_231](end_span)
                            [span_232](start_span)<Check size={16} className="text-green-400" /> : <Copy size={16} className="text-slate-400" />}[span_232](end_span)
                        </button>
                      </div>
                    </div>
                  </div>
        
                  [span_233](start_span)<p className="text-xs text-slate-500 mt-2">[span_233](end_span)
                    [span_234](start_span)Создано: {new Date(user.created_at).toLocaleString('ru-RU')}[span_234](end_span)
                  </p>
                </div>
              [span_235](start_span)))}[span_235](end_span)
            </div>
          </div>
        )}

        [span_236](start_span){activeTab === 'access' && ([span_236](end_span)
          [span_237](start_span)<div className="space-y-6">[span_237](end_span)
            [span_238](start_span)<div className="bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6">[span_238](end_span)
              [span_239](start_span)<h2 className="text-xl font-bold text-white mb-4">Управление доступами</h2>[span_239](end_span)
              [span_240](start_span)<p className="text-slate-400 text-sm">[span_240](end_span)
                [span_241](start_span)Нажмите на иконку, чтобы выдать или отозвать доступ пользователя к приложению[span_241](end_span)
              </p>
            </div>

            [span_242](start_span)<div className="overflow-x-auto">[span_242](end_span)
              <table className="w-full">
                [span_243](start_span)<thead>[span_243](end_span)
                  [span_244](start_span)<tr className="border-b border-slate-700">[span_244](end_span)
                    [span_245](start_span)<th className="text-left p-4 text-slate-400 font-semibold">Пользователь</th>[span_245](end_span)
                    {apps.map(app => (
                      [span_246](start_span)<th key={app.app_id} className="text-center p-4 text-slate-400 font-semibold">[span_246](end_span)
                        [span_247](start_span){app.app_name}[span_247](end_span)
                      </th>
                    ))}
                  </tr>
                </thead>
                [span_248](start_span)<tbody>[span_248](end_span)
                  {users.map(user => (
                    [span_249](start_span)<tr key={user.user_id} className="border-b border-slate-800">[span_249](end_span)
                      <td className="p-4">
                        [span_250](start_span)<div className="flex items-center gap-2">[span_250](end_span)
                          <div>
                            [span_251](start_span)<div className="text-white font-semibold">{user.username}</div>[span_251](end_span)
                            [span_252](start_span)<div className="text-xs text-slate-500">{user.user_id}</div>[span_252](end_span)
                          [span_253](start_span)</div>[span_253](end_span)
                          [span_254](start_span)<span className={`px-2 py-0.5 rounded text-xs border ${getRoleBadge(user.role)}`}>[span_254](end_span)
                            [span_255](start_span){user.role}[span_255](end_span)
                          </span>
                        </div>
                      </td>
                      {apps.map(app => {
                        [span_256](start_span)const access = hasAccess(user.user_id, app.app_id);[span_256](end_span)
                        return (
                          <td key={app.app_id} className="p-4 text-center">
                            <button
                              [span_257](start_span)onClick={() => toggleAccess(user.user_id, app.app_id, access)}[span_257](end_span)
                              className={`p-2 rounded-lg transition ${
                                access
                                  ? [span_258](start_span)'bg-green-600/20 hover:bg-green-600/30 text-green-400'[span_258](end_span)
                                  [span_259](start_span): 'bg-red-600/20 hover:bg-red-600/30 text-red-400'[span_259](end_span)
                              }`}
                            >
                              {access ? [span_260](start_span)<CheckCircle size={20} /> : <XCircle size={20} />}[span_260](end_span)
                            </button>
                          </td>
                        [span_261](start_span));[span_261](end_span)
                      })}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        [span_262](start_span))}[span_262](end_span)
      </div>
    </div>
  );
};
[span_263](start_span)export default AdminPanel;[span_263](end_span)
      
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(AdminPanel));
    </script>
</body>
</html>